<!DOCTYPE html>
<html lang="sq">
<head>
  <meta charset="UTF-8">
  <title>Tabela 14 Ditore</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f9; display: flex; justify-content: center; padding: 20px; }
    table { border-collapse: collapse; width: 600px; background: white; box-shadow: 0 0 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background: #007bff; color: white; }
    input { width: 120px; padding: 5px; text-align: right; }
    button { padding: 8px 12px; border: none; cursor: pointer; border-radius: 4px; margin: 5px; }
    .save-btn { background: #28a745; color: white; }
    .save-btn:hover { background: #218838; }
    .view-btn { background: #6f42c1; color: white; }
    .view-btn:hover { background: #563d7c; }
    .clear-btn { background: #dc3545; color: white; }
    .clear-btn:hover { background: #c82333; }
    #totals { text-align: center; font-weight: bold; margin-bottom: 20px; }
    #totals span { display: block; margin-top: 5px; }
    #totals .original { color: green; font-size: 18px; }
  </style>
</head>
<body>


  <div>
    <h2>Tabela e skeleve</h2>
    <table id="work-table"></table>
    <div id="totals"></div>
    <button class="save-btn" onclick="saveTable()">ðŸ’¾ Ruaj tabelÃ«n</button>
    <button class="view-btn" onclick="window.location.href='rezultatet.html'">ðŸ“Š Shiko tÃ« gjitha</button>
    <button class="clear-btn" onclick="clearTable()">ðŸ§¹ Pastro tÃ« DhÃ«nat</button>
  </div>

  <script>
    const ditetJaves = ["E HÃ«nÃ«", "E MartÃ«", "E MÃ«rkurÃ«", "E Enjte", "E Premte", "E ShtunÃ«", "E Diel"];
    const tableElement = document.getElementById("work-table");
    const totalsDiv = document.getElementById("totals");

    let data = Array(14).fill("");

    // Ngarkon tÃ« dhÃ«nat e ruajtura mÃ« parÃ« (nÃ«se ka)
    const savedData = JSON.parse(localStorage.getItem("currentTable"));
    if(savedData) data = savedData;

    function renderTable() {
      let html = `<tr><th>Dita</th><th>Numri i skeleve</th></tr>`;
      for (let i = 0; i < 14; i++) {
        html += `<tr>
                  <td>${ditetJaves[i % 7]} ${i < 7 ? "(Java 1)" : "(Java 2)"}</td>
                  <td><input type="number" value="${data[i] || ""}" onchange="updateValue(${i}, this.value)"></td>
                 </tr>`;
      }
      tableElement.innerHTML = html;
      calculateTotals();
    }

    function updateValue(index, value) {
      data[index] = value ? parseFloat(value) : "";
      localStorage.setItem("currentTable", JSON.stringify(data)); // ruan automatikisht edhe nÃ« localStorage
      calculateTotals();
    }

    function calculateTotals() {
      let sum = 0;
      data.forEach(v => { if(v !== "" && !isNaN(v)) sum += parseFloat(v); });
      totalsDiv.innerHTML = `
        <span>Qmimorja Ã—1.75 per pages ${(sum*1.75).toFixed(2)}â‚¬</span>
        <span class="original">Shuma e skeleve: ${sum.toFixed(2)}</span>
      `;
    }

    function saveTable() {
      let allTables = JSON.parse(localStorage.getItem("allTables")) || [];
      let now = new Date().toLocaleString();
      allTables.push({ data, savedAt: now });
      localStorage.setItem("allTables", JSON.stringify(allTables));
      alert("Tabela u ruajt me sukses!");
    }

    function clearTable() {
      if(confirm("A je i sigurt qÃ« do tÃ« pastrosh tÃ« gjitha tÃ« dhÃ«nat e kÃ«saj tabele?")) {
        data = Array(14).fill("");
        localStorage.setItem("currentTable", JSON.stringify(data));
        renderTable();
      }
    }

    renderTable();

    function saveTable(){
  let allTables = JSON.parse(localStorage.getItem("allTables")) || [];
  
  // Llogarit shumÃ«n e tabelÃ«s aktuale
  let sumCurrent = 0;
  data.forEach(v => { if(v!=="" && !isNaN(v)) sumCurrent += parseFloat(v); });

  // Ruaj tabela
  let now = new Date().toLocaleString();
  allTables.push({data, savedAt: now});
  localStorage.setItem("allTables", JSON.stringify(allTables));

  // PÃ«rditÃ«so grandTotal
  let grandTotal = parseFloat(localStorage.getItem("grandTotal")) || 0;
  grandTotal += sumCurrent;
  localStorage.setItem("grandTotal", grandTotal);

  alert("Tabela u ruajt me sukses!");
}

  </script>
</body>
</html>
